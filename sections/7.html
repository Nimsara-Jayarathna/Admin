<h1>ðŸ“¢ Promotion Management (Admin View)</h1>

<!-- Entity Switcher -->
<div style="display: flex; gap: 10px; margin-bottom: 20px;">
  <button onclick="switchPromo('merchant')" style="background-color:#007BFF;color:white;padding:8px 16px;border:none;border-radius:5px;">Merchant</button>
  <button onclick="switchPromo('distributor')" style="background-color:#007BFF;color:white;padding:8px 16px;border:none;border-radius:5px;">Distributor</button>
</div>

<!-- Promotion View -->
<div id="promo-content"></div>

<script>
  const promoData = {
    merchant: [
      {
        name: "Nadeesha Perera",
        limit: 1,
        promotions: [
          {
            title: "Hair Care Discount",
            description: "Flat 25% off on salon packages.",
            attachment: "haircare_offer.pdf",
            startDate: "2025-07-01",
            endDate: "2025-07-10"
          }
        ]
      },
      {
        name: "Ruwan Silva",
        limit: 2,
        promotions: []
      }
    ],
    distributor: [
      {
        name: "ABC Distributors",
        limit: 1,
        promotions: [
          {
            title: "Back to School",
            description: "Stationery + Backpack deals!",
            attachment: "b2s_bundle.pdf",
            startDate: "2025-06-28",
            endDate: "2025-07-03"
          }
        ]
      },
      {
        name: "QuickTech Solutions",
        limit: 2,
        promotions: [
          {
            title: "Gadget Days",
            description: "10% off all electronics.",
            attachment: "gadget_sale.pdf",
            startDate: "2025-07-02",
            endDate: "2025-07-08"
          },
          {
            title: "Free Delivery Week",
            description: "Free shipping for orders above LKR 5000.",
            attachment: "delivery_free.pdf",
            startDate: "2025-07-01",
            endDate: "2025-07-04"
          }
        ]
      }
    ]
  };

  function switchPromo(type) {
    const today = new Date().toISOString().split("T")[0];
    const list = promoData[type];
    let html = `<h2>ðŸ“„ ${type === "merchant" ? "Merchant" : "Distributor"} Promotions</h2>`;

    list.forEach((entity, idx) => {
      html += `
        <div style="border:1px solid #ccc; padding:15px; margin-bottom:20px; border-radius:6px;">
          <h3>${entity.name}</h3>
          <p><strong>Current Promotion Limit:</strong> ${entity.limit}</p>
          <button onclick="increasePromoLimit('${type}', ${idx})" style="background-color:#28a745;color:white;padding:6px 12px;border:none;border-radius:4px;">Increase Limit</button>
          <div style="margin-top:10px;">
            ${
              entity.promotions.length === 0 
              ? `<p style="color:#999;">No promotions uploaded yet.</p>` 
              : `<ul style="list-style:none;padding:0;">
                  ${entity.promotions.map(promo => {
                    const expired = today > promo.endDate;
                    return `
                      <li style="margin-bottom:10px; border-left:4px solid ${expired ? 'red' : 'green'}; padding-left:10px;">
                        <strong>${promo.title}</strong> â€“ <em>${promo.description}</em><br>
                        Attachment: <a href="${promo.attachment}" target="_blank">${promo.attachment}</a><br>
                        <small>Start: ${promo.startDate} | End: ${promo.endDate} (${expired ? 'Expired' : 'Active'})</small>
                      </li>`;
                  }).join('')}
                </ul>`
            }
          </div>
        </div>
      `;
    });

    document.getElementById("promo-content").innerHTML = html;
  }

  function increasePromoLimit(type, idx) {
    const input = prompt("Increase limit by how many?");
    const extra = parseInt(input);
    if (!isNaN(extra) && extra > 0) {
      promoData[type][idx].limit += extra;
      switchPromo(type);
    }
  }

  // Initial load
  switchPromo("merchant");
</script>
